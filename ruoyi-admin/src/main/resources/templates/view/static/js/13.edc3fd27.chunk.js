(this["webpackJsonpcesium-demo"]=this["webpackJsonpcesium-demo"]||[]).push([[13],{399:function(e,t,n){"use strict";n.r(t),n.d(t,"default",(function(){return p}));var i=n(49),s=n(50),o=(n(10),n(123)),r=n.n(o),a=n(195),c=n.n(a),u=n(994),l=(n(456),n(23)),p=function(){function e(t,n,s){Object(i.a)(this,e),this.viewer=t,this.cesium=n,this.extensionName="Measurement/measureTools/AreaGround",this.ids=[],this.coms=[],this.options=s,this.isRunning=!0}return Object(s.a)(e,[{key:"getGuid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"xxxxxxxxxx",t=(new Date).getTime(),n=e.replace(/[xy]/g,(function(e){var n=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?n:7&n|8).toString(16)}));return n}},{key:"create",value:function(){var e=this;if(!(this.coms.length>0&&this.coms[this.coms.length-1].state.showTag)){var t=c()("#cesiumContainer")[0],n=this.getGuid(),i="<div id=".concat(n,"></div>");c()(t).append(i);var s=r.a.render(Object(l.jsx)(u.a,{viewer:this.viewer,options:this.options}),document.getElementById(n));s.stateChange.addEventListener((function(t){e.isRunning=t})),this.ids.push(n),this.coms.push(s)}}},{key:"load",value:function(){return!0}},{key:"unload",value:function(){return this.ids.forEach((function(e){r.a.unmountComponentAtNode(document.getElementById(e)),c()("#"+e).remove()})),this.viewer.modes[this.extensionName]=null,!0}}]),e}()},456:function(e,t,n){"use strict";n.d(t,"c",(function(){return i})),n.d(t,"b",(function(){return s})),n.d(t,"d",(function(){return a})),n.d(t,"a",(function(){return c}));var i,s,o=n(49),r=n(50);function a(e,t){return e.entities.add({position:t,point:{pixelSize:5,color:Cesium.Color.WHITE,outlineColor:Cesium.Color.DEEPPINK,outlineWidth:2,disableDepthTestDistance:Number.POSITIVE_INFINITY}})}!function(e){e.POINT="\u70b9\u6d4b\u91cf",e.LINE="\u7ebf\u6bb5\u6d4b\u91cf",e.VOLUME="\u4f53\u79ef\u6d4b\u91cf",e.AREA="\u9762\u79ef\u6d4b\u91cf"}(i||(i={})),function(e){e.WAITING="\u7b49\u5f85\u4e2d",e.SAMPLING="\u91c7\u6837\u4e2d",e.COMPUING="\u8ba1\u7b97\u4e2d",e.FINISHED="\u6d4b\u91cf\u7ed3\u675f"}(s||(s={}));var c=function(){function e(t){var n=this;Object(o.a)(this,e),this.type=void 0,this.currentMeasure=void 0,this.handler=void 0,this._beActived=!1,this.viewer=void 0,this.addSamplePoint=function(e){var t=function(e,t){var n=e.camera.getPickRay(t),i=e.scene.pickFromRay(n,[]);return i&&null!=i.position?e.scene.clampToHeight(i.position):null}(n.viewer,e);return null!=t?{ins:a(n.viewer,t),pos:t}:null},this.active=function(){n.beActived=!0,n.onStateChange.raiseEvent(n.beActived)},this.onSampleChange=new Cesium.Event,this.onStateChange=new Cesium.Event,this.onEndMeasure=new Cesium.Event,this.viewer=t,this.createEventHandler()}return Object(r.a)(e,[{key:"beActived",get:function(){return this._beActived},set:function(e){this._beActived=e,this.onStateChange.raiseEvent(e)}},{key:"disActive",value:function(){this.beActived=!1,this.onStateChange.raiseEvent(this.beActived),this.currentMeasure.dispose(this.viewer),this.currentMeasure=void 0}}]),e}()},486:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i=n(514),s=n(49),o=n(50),r=n(52),a=n(51),c=n(10),u=n.n(c),l=(n(487),n(23)),p=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(e){var i;(Object(s.a)(this,n),(i=t.call(this,e)).element=void 0,i.mousePos=void 0,i.onUpdate=function(){if(null!=i.element){var e;if(i.props.trackCursor)e=i.mousePos;else if(i.props.trackEntity){var t=i.props.trackEntity.position.getValue(Cesium.JulianDate.now());e=Cesium.SceneTransforms.wgs84ToWindowCoordinates(i.props.viewer.scene,t)}else i.props.trackPos&&(e=Cesium.SceneTransforms.wgs84ToWindowCoordinates(i.props.viewer.scene,i.props.trackPos));if(e){switch(i.element.style.display="",i.props.alignX){case"left":i.element.style.left=e.x+"px";break;case"center":i.element.style.left=e.x+.5*i.element.clientWidth+"px";break;case"right":default:i.element.style.left=e.x-.5*i.element.clientWidth+"px"}switch(i.props.alignY){case"top":i.element.style.top=e.y-i.element.clientHeight+"px";break;case"bottom":i.element.style.top=e.y+"px";break;case"center":default:i.element.style.top=e.y-.5*i.element.clientHeight+"px"}}else i.element.style.display="none"}},e.trackCursor)&&(new Cesium.ScreenSpaceEventHandler).setInputAction((function(e){var t=i.props.viewer.container.getBoundingClientRect();i.mousePos=Cesium.Cartesian2.subtract(e.endPosition,new Cesium.Cartesian2(t.left,t.top),new Cesium.Cartesian2)}),Cesium.ScreenSpaceEventType.MOUSE_MOVE);return i}return Object(o.a)(n,[{key:"componentDidMount",value:function(){this.props.viewer.scene.preUpdate.addEventListener(this.onUpdate)}},{key:"componentWillUnmount",value:function(){this.props.viewer&&!this.props.viewer.isDestroyed()&&this.props.viewer.scene.preUpdate.removeEventListener(this.onUpdate)}},{key:"render",value:function(){var e=this;return Object(l.jsxs)("div",{className:"cesium-tag",ref:function(t){return e.element=t},style:Object(i.a)({},this.props.textCss),children:[this.props.text,this.props.children]})}}]),n}(u.a.Component)},487:function(e,t,n){},488:function(e,t,n){"use strict";n.d(t,"a",(function(){return p}));var i,s=n(49),o=n(50),r=n(52),a=n(51),c=n(10),u=n.n(c),l=(n(489),n(23));!function(e){e.LEFT="left",e.BOTTOM="bottom"}(i||(i={}));var p=function(e){Object(r.a)(n,e);var t=Object(a.a)(n);function n(){return Object(s.a)(this,n),t.apply(this,arguments)}return Object(o.a)(n,[{key:"render",value:function(){var e;return Object(l.jsx)("div",{className:"chat-frame ".concat(null!==(e=this.props.location)&&void 0!==e?e:"left"),children:Object(l.jsx)("span",{children:this.props.text})})}}]),n}(u.a.Component)},489:function(e,t,n){},490:function(e,t,n){},508:function(e,t,n){"use strict";n.d(t,"e",(function(){return s})),n.d(t,"a",(function(){return o})),n.d(t,"f",(function(){return r})),n.d(t,"d",(function(){return c})),n.d(t,"b",(function(){return u})),n.d(t,"c",(function(){return l}));n(509);var i=n(537);function s(e){var t=[];e.map((function(e){t.push([e.lng,e.lat])}));var n=i.polygon([t]);return i.area(n)}function o(e,t){if(e&&t){var n=e.scene.camera.getPickRay(t),i=e.scene.globe.pick(n,e.scene);if(void 0==e.scene.pick(t)&&i){var s=Cesium.Ellipsoid.WGS84.cartesianToCartographic(i),o=Cesium.Math.toDegrees(s.longitude),r=Cesium.Math.toDegrees(s.latitude),a=e.scene.globe.getHeight(s),c=parseFloat(a.toFixed(2));return Cesium.Cartesian3.fromDegrees(o,r,c)}var u=e.scene.pickPosition(t);return Cesium.defined(u)?u:null}}function r(e){return e?e.map((function(e){return function(e){var t=Cesium.Ellipsoid.WGS84.cartesianToCartographic(e);return{lng:Cesium.Math.toDegrees(t.longitude),lat:Cesium.Math.toDegrees(t.latitude),alt:t.height}}(e)})):[]}function a(e){return e?Cesium.Cartographic.fromDegrees(e.lng,e.lat,e.alt):Cesium.Cartographic.ZERO}function c(e){for(var t=0,n=0;n<e.length-1;n++){var i=a(e[n]),s=a(e[n+1]),o=new Cesium.EllipsoidGeodesic;o.setEndPoints(i,s);var r=o.surfaceDistance;t+=r=Math.sqrt(Math.pow(r,2)+Math.pow(s.height-i.height,2))}return parseFloat(t.toFixed(3))}function u(e,t){if(e&&t){var n=e.scene.camera.getPickRay(t),i=e.scene.globe.pick(n,e.scene);if(void 0==e.scene.pick(t)&&i){var s=Cesium.Ellipsoid.WGS84.cartesianToCartographic(i),o=Cesium.Math.toDegrees(s.longitude),r=Cesium.Math.toDegrees(s.latitude),a=e.scene.globe.getHeight(s);return{degree:{lng:o,lat:r,alt:u=a||0},cartesian3:Cesium.Cartesian3.fromDegrees(o,r,u)}}var c=e.scene.pickPosition(t);if(Cesium.defined(c)){var u,l=Cesium.Cartographic.fromCartesian(c);return{degree:{lng:o=Cesium.Math.toDegrees(l.longitude),lat:r=Cesium.Math.toDegrees(l.latitude),alt:u=l.height},cartesian3:Cesium.Cartesian3.fromDegrees(o,r,u)}}}return null}function l(e,t,n){return new Cesium.Cartesian3((t.x+n.x)/2,(t.y+n.y)/2,(t.z+n.z)/2)}},994:function(e,t,n){"use strict";n.d(t,"a",(function(){return v}));var i=n(49),s=n(50),o=n(52),r=n(51),a=n(10),c=n.n(a),u=n(486),l=n(488),p=(n(490),n(508)),h=n(456),d=n(23),v=function(e){Object(o.a)(n,e);var t=Object(r.a)(n);function n(e){var s;return Object(i.a)(this,n),(s=t.call(this,e)).markPointsEntity=void 0,s.positions=void 0,s.degrees=void 0,s.polygon=void 0,s._polygonEntity=void 0,s._labelEntity=void 0,s._label=void 0,s._handler=void 0,s._labelPoint=void 0,s.stateChange=void 0,s.state={tagText:null,showTag:!0},s.create=function(){s._polygonEntity.polyline=new Cesium.PolylineGraphics({width:3,material:Cesium.Color.RED.withAlpha(.8),clampToGround:s.props.options.clampToGround||!1}),s._polygonEntity.polyline.positions=new Cesium.CallbackProperty((function(){return s.positions}),!1),s._polygonEntity.polygon=new Cesium.PolygonGraphics({hierarchy:new Cesium.CallbackProperty((function(){return s.polygon}),!1),perPositionHeight:!0,material:Cesium.Color.YELLOW.withAlpha(.3)}),s.props.viewer.entities.add(s._polygonEntity)},s._addInfoPoint=function(e){s._labelPoint=e.clone(),s._label=(Object(p.e)(s.degrees)/1).toFixed(4)+"\u5e73\u65b9\u7c73",s.props.options.callback&&s.props.options.callback(s.degrees,s._polygonEntity)},s.markPointsEntity=[],s.positions=[],s.degrees=[],s.polygon=new Cesium.PolygonHierarchy,s._polygonEntity=null,s._labelEntity=null,s._label="",s._handler=new Cesium.ScreenSpaceEventHandler(s.props.viewer.scene.canvas),s.stateChange=new Cesium.Event,s}return Object(s.a)(n,[{key:"componentDidMount",value:function(){var e=this;this.setState({tagText:"\u5de6\u5355\u51fb-\u5f00\u59cb\u7ed8\u5236"}),this._handler.setInputAction((function(t){var n=Object(p.b)(e.props.viewer,t.position);n&&n.cartesian3&&n.cartesian3.x&&(e.positions.length<=2?e.setState({tagText:"\u5de6\u5355\u51fb-\u589e\u52a0\u70b9"}):e.setState({tagText:"\u5de6\u5355\u51fb-\u589e\u52a0\u70b9 \u53f3\u5355\u51fb\u7ed3\u675f\u7ed8\u5236"}),e.polygon.positions.push(n.cartesian3.clone()),e.positions.push(n.cartesian3.clone()),e.degrees.push(n.degree),e.markPointsEntity.push(Object(h.d)(e.props.viewer,n.cartesian3)),e.positions.length<=2?e.setState({tagText:"\u5de6\u5355\u51fb-\u589e\u52a0\u70b9"}):e.setState({tagText:"\u5de6\u5355\u51fb-\u589e\u52a0\u70b9 \u53f3\u5355\u51fb\u7ed3\u675f\u7ed8\u5236"}),e._polygonEntity||(e._polygonEntity=new Cesium.Entity,e.create()))}),Cesium.ScreenSpaceEventType.LEFT_CLICK),this._handler.setInputAction((function(t){e.positions.length<=2||(e._handler.destroy(),e.positions.push(e.positions[0]),e.degrees.push(e.degrees[0]),e._addInfoPoint(e.positions[0]),e.setState({showTag:!1}),e.stateChange.raiseEvent(!1))}),Cesium.ScreenSpaceEventType.RIGHT_CLICK)}},{key:"componentWillUnmount",value:function(){var e=this;this.props.viewer.entities.remove(this._polygonEntity),this.props.viewer.entities.remove(this._labelEntity),this.markPointsEntity.forEach((function(t){return e.props.viewer.entities.remove(t)}))}},{key:"render",value:function(){var e=this.state,t=(e.tagText,e.showTag);return Object(d.jsxs)(c.a.Fragment,{children:[t?Object(d.jsx)(u.a,{viewer:this.props.viewer,trackCursor:!0,alignX:"left",alignY:"center",children:Object(d.jsx)(l.a,{text:this.state.tagText})}):null,this._labelPoint?Object(d.jsx)(u.a,{viewer:this.props.viewer,trackPos:this._labelPoint,alignX:"left",alignY:"center",children:Object(d.jsx)(l.a,{text:this._label})}):Object(d.jsx)(d.Fragment,{})]})}}]),n}(c.a.Component)}}]);