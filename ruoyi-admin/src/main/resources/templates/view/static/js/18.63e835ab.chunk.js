(this["webpackJsonpcesium-demo"]=this["webpackJsonpcesium-demo"]||[]).push([[18],{406:function(e,t,i){"use strict";i.r(t),i.d(t,"default",(function(){return F}));var n=i(49),r=i(50),s=i(10),a=i.n(s),o=i(123),l=i.n(o),u=i(195),c=i.n(u),h=i(52),m=i(51),p=i(509),d=i(73),v=i.n(d),C=i(94),g=i(514),f=i(96);function w(e,t,i){return(w="undefined"!==typeof Reflect&&Reflect.get?Reflect.get:function(e,t,i){var n=function(e,t){for(;!Object.prototype.hasOwnProperty.call(e,t)&&null!==(e=Object(f.a)(e)););return e}(e,t);if(n){var r=Object.getOwnPropertyDescriptor(n,t);return r.get?r.get.call(i):r.value}})(e,t,i||e)}var y=i(456),b=window.Cesium,P=function(){function e(){Object(n.a)(this,e),this.type=y.c.AREA,this.active=function(){},this.disActive=function(){},this.onMeasureEnd=function(){}}return Object(r.a)(e,null,[{key:"compute",value:function(e){for(var t=e[0],i=new b.Cartesian3,n=new b.Cartesian3,r=0,s=1;s<e.length-1;s++){var a=b.Cartesian3.subtract(e[s],t,i),o=b.Cartesian3.subtract(e[s+1],t,n),l=b.Cartesian3.cross(a,o,new b.Cartesian3);r+=b.Cartesian3.magnitude(l)/2}return r}}]),e}(),x=i(537),E=window.Cesium,S=function(){function e(){Object(n.a)(this,e),this.primitive=null,this.selected=!1,this._color=null}return Object(r.a)(e,[{key:"translation",value:function(e,t,i){E.Matrix4.multiplyByTranslation(this.primitive.modelMatrix,E.Cartesian3.multiplyByScalar(t,i,new E.Cartesian3),this.primitive.modelMatrix)}},{key:"rotationAxis",value:function(e){E.Matrix4.multiply(this.primitive.modelMatrix,e,this.primitive.modelMatrix)}},{key:"rotation",value:function(e){this.instance=[],this.primitive.geometryInstances.constructor===Array?this.instance=this.primitive.geometryInstances:this.instance=[this.primitive.geometryInstances];for(var t=0;t<this.instance.length;t++)E.Matrix4.multiply(this.instance[t].modelMatrix,e,this.instance[t].modelMatrix)}},{key:"rest",value:function(){this.selected=!1,this.primitive.appearance=new E.PerInstanceColorAppearance,this.primitive.geometryInstances&&(this.primitive.geometryInstances[0].attributes.color=E.ColorGeometryInstanceAttribute.toValue(this._color),this.primitive.geometryInstances[1].attributes.color=E.ColorGeometryInstanceAttribute.toValue(E.Color.RED))}},{key:"select",value:function(){this.selected=!0,this.primitive.appearance=new E.MaterialAppearance({material:E.Material.fromType("Color",{color:E.Color.WHITE})})}},{key:"is",value:function(e){return!!this.primitive._instanceIds.find((function(t){return t===e}))}}]),e}(),I=window.Cesium,M=function(e){Object(h.a)(i,e);var t=Object(m.a)(i);function i(){var e,r=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};Object(n.a)(this,i),(e=t.call(this)).direction=null,e.unit=null,e._color=r.color||I.Color.RED,e._width=r.width||.05,e._length=r.length||6,e._headWidth=r.headWidth||2*e._width,e._headLength=r.headLength||4*e._width,e._inverse=r.inverse||!1,e.position=r.position,e.direction=r.direction,e.modelMatrix=r.modelMatrix||I.Transforms.eastNorthUpToFixedFrame(e.position),e.unit=r.unit;var s=r.id,a=I.CylinderGeometry.createGeometry(new I.CylinderGeometry({length:Math.max(e._length,6),topRadius:e._width,bottomRadius:e._width})),o=I.CylinderGeometry.createGeometry(new I.CylinderGeometry({length:e._headLength,topRadius:e._inverse?e._headWidth:0,bottomRadius:e._inverse?0:e._headWidth})),l=(Math.max(e._length,6)+e._headLength)/2;return e._inverse&&(l=-l),e.translate(o,[0,0,2*l-1]),e.translate(a,[0,0,l-1]),e.primitive=new I.Primitive({modelMatrix:e.modelMatrix,geometryInstances:[new I.GeometryInstance({id:s+"-line",geometry:a,attributes:{color:I.ColorGeometryInstanceAttribute.fromColor(e._color)}}),new I.GeometryInstance({id:s+"-arrow",geometry:o,attributes:{color:I.ColorGeometryInstanceAttribute.fromColor(I.Color.RED)}})],appearance:new I.PerInstanceColorAppearance,asynchronous:!1,releaseGeometryInstances:!1}),e}return Object(r.a)(i,[{key:"translate",value:function(e,t){var i=new I.Cartesian3;Array.isArray(t)?(i.x=t[0],i.y=t[1],i.z=t[2]):I.Cartesian3.clone(t,i);for(var n=0;n<e.attributes.position.values.length;n+=3)e.attributes.position.values[n]+=i.x,e.attributes.position.values[n+1]+=i.y,e.attributes.position.values[n+2]+=i.z}}]),i}(S),T=(window.Cesium,window.Cesium),O=function e(t){var i=this;Object(n.a)(this,e),this.viewer=null,this.position=null,this.axisZ=null,this.pickRay=new window.Cesium.Ray,this.axis=null,this.entity=null,this.center=null,this.boundingSphere=null,this.heightChanged=0,this.diffHeight=0,this.entityMatrix=null,this.add=function(e,t,n,r){i.destroy(),i.diffHeight=r,i.entity=e,i.boundingSphere=n,i.entityMatrix=i.entity.computeModelMatrix(T.JulianDate.now()),i.position=t,i.primitives=new T.PrimitiveCollection,i._createRod(),i._addRod(),i._addListener()},this._addListener=function(){i.viewer.screenSpaceEventHandler.setInputAction(i._clickListener,T.ScreenSpaceEventType.LEFT_DOWN),i.viewer.screenSpaceEventHandler.setInputAction(i._clickUpListener,T.ScreenSpaceEventType.LEFT_UP),i.viewer.screenSpaceEventHandler.setInputAction(i._moveListener,T.ScreenSpaceEventType.MOUSE_MOVE)},this.destroy=function(){i._removeListener(),i.primitives&&!i.primitives.isDestroyed()&&(i.primitives.removeAll(),i.primitives.destroy())},this.setCameraController=function(e){i.viewer.scene.screenSpaceCameraController.enableRotate=e,i.viewer.scene.screenSpaceCameraController.enableTranslate=e,i.viewer.scene.screenSpaceCameraController.enableZoom=e,i.viewer.scene.screenSpaceCameraController.enableTilt=e,i.viewer.scene.screenSpaceCameraController.enableLook=e},this._removeListener=function(){i.viewer.screenSpaceEventHandler.removeInputAction(T.ScreenSpaceEventType.LEFT_DOWN),i.viewer.screenSpaceEventHandler.removeInputAction(T.ScreenSpaceEventType.LEFT_UP),i.viewer.screenSpaceEventHandler.removeInputAction(T.ScreenSpaceEventType.MOUSE_MOVE)},this._createRod=function(){var e={length:i.boundingSphere.radius/2,position:i.position,width:.2},t=T.Matrix4.toArray(i.entityMatrix),n=new T.Cartesian3(t[8],t[9],t[10]);i.axisZ=new M(Object(g.a)({id:"axisZ",color:T.Color.BLUE,direction:n,unit:T.Cartesian3.UNIT_Z},e))},this._addRod=function(){i.primitives.add(i.axisZ.primitive),i.viewer.scene.primitives.add(i.primitives)},this.translationAxisIsSelected=function(){return i.axisZ.selected},this._clickListener=function(e){var t=i.viewer.scene.pick(e.position);if(t&&t.id){i._resetMaterial();var n=null;i.axisZ.is(t.id)&&(n=i.axisZ),n&&(i.axis=n,i.axis.select(),i.setCameraController(!1))}},this._clickUpListener=function(){i.axis=null,i._resetMaterial(),i.setCameraController(!0)},this._moveListener=function(e){var t=i.viewer.scene.pick(e.endPosition);i.axis?i.translationAxisIsSelected()&&i._precessTranslation(e,i.axis):t&&t.id?i.axisZ.is(t.id)&&(i.axisZ.primitive.appearance=new T.MaterialAppearance({material:T.Material.fromType("Color",{color:T.Color.WHITE})})):i._resetMaterial()},this._precessTranslation=function(e,t){i.viewer.scene.camera.getPickRay(e.startPosition,i.pickRay);var n=i.getPlanePosition(i.position,i.viewer.scene.camera.position.clone(),i.pickRay,t.direction);i.viewer.scene.camera.getPickRay(e.endPosition,i.pickRay);var r=i.getPlanePosition(i.position,i.viewer.scene.camera.position.clone(),i.pickRay,t.direction),s=new T.Cartesian3;T.Cartesian3.subtract(r,n,s);var a=T.Cartesian3.dot(t.direction,s);i.translation(s,t.unit,a),i.heightChanged+=a;var o="Measurement/measureTools/volume";i.viewer.modes[o]&&i.viewer.modes[o].reCompute(i.heightChanged)},this.translation=function(e,t,n){i.axisZ.translation(e,t,n)},this._resetMaterial=function(){i.axisZ.rest()},this.extended=function(e,t){var i=new T.Cartesian3;return T.Cartesian3.normalize(e,i),T.Cartesian3.add(e,T.Cartesian3.multiplyByScalar(i,t,i),i),i},this.getPlanePosition=function(e,t,i,n){var r=T.Cartesian3.subtract(t,e,new T.Cartesian3),s=T.Cartesian3.dot(r,n);T.Cartesian3.multiplyByScalar(n,s,r),T.Cartesian3.add(e,r,r);var a=T.Cartesian3.subtract(t,r,new T.Cartesian3);T.Cartesian3.normalize(a,r);var o=T.Cartesian3.dot(i.direction,r),l=T.Cartesian3.magnitude(a);return T.Cartesian3.multiplyByScalar(i.direction,-l/o,r),r},this.getPlaneRotationPosition=function(e,t,i,n){var r=T.Cartesian3.subtract(t,e,new T.Cartesian3),s=T.Cartesian3.dot(r,n),a=T.Cartesian3.dot(i.direction,n);return T.Cartesian3.multiplyByScalar(i.direction,-s/a,r),T.Cartesian3.add(t,r,r),T.Cartesian3.subtract(r,e,new T.Cartesian3)},this.viewer=t},k=function(){function e(t){var i=this;Object(n.a)(this,e),this.state=void 0,this.options=void 0,this.samplePoints=void 0,this.volumeSamplePoints=void 0,this.basePloygon=void 0,this.basePlan=void 0,this.Wall=void 0,this.sampleHeightToPlan=void 0,this.minHeight=void 0,this.maxHeight=void 0,this.projectPosArr=void 0,this.basePloygonArea=void 0,this.centerPos=void 0,this.tag=void 0,this.result=void 0,this.adjustPolygonHeight=function(e){i.basePlan.polygon.hierarchy=i.projectPosArr.map((function(t){var i=Cesium.Cartographic.fromCartesian(t);return Cesium.Cartesian3.fromRadians(i.longitude,i.latitude,i.height+e)}))},this.state=y.b.SAMPLING,this.samplePoints=[],this.basePloygon=t.entities.add({polygon:{hierarchy:new Cesium.CallbackProperty((function(){return new Cesium.PolygonHierarchy(i.samplePoints.map((function(e){return e.pos.clone()})))}),!1),material:Cesium.Color.AQUA.withAlpha(.3),outline:!0,outlineWidth:20}})}return Object(r.a)(e,[{key:"dispose",value:function(e){var t,i;e.entities.remove(this.tag),e.entities.remove(this.basePloygon),e.entities.remove(this.basePlan),e.entities.remove(this.Wall),null===(t=this.samplePoints)||void 0===t||t.forEach((function(t){return e.entities.remove(t.ins)})),null===(i=this.volumeSamplePoints)||void 0===i||i.forEach((function(t){return e.entities.remove(t)}))}},{key:"endSample",value:function(){this.state=y.b.FINISHED;var e=this.sampleHeightToPlan,t=this.basePloygonArea,i=this.options.adjustheight,n=[],r=[];e.forEach((function(e){var t=e-i;t<0?r.push(Math.abs(t)):n.push(t)}));var s=n.reduce((function(e,t){return e+t}),0),a=r.reduce((function(e,t){return e+t}),0),o=s*t/e.length,l=a*t/e.length;this.result={cutVolume:o,fillVolume:l},this.adjustPolygonHeight(i)}}]),e}(),j=function(e){Object(h.a)(i,e);var t=Object(m.a)(i);function i(){var e;Object(n.a)(this,i);for(var r=arguments.length,s=new Array(r),a=0;a<r;a++)s[a]=arguments[a];return(e=t.call.apply(t,[this].concat(s))).type=y.c.VOLUME,e.clippingPlanes=void 0,e.control=void 0,e.highestPoint=void 0,e.lowestPoint=void 0,e.maxHeight=void 0,e.minHeight=void 0,e.keduPoint=void 0,e.keduLabel=void 0,e.keduLine=void 0,e.wheelHandler=void 0,e.measureOptions={basePlaneHeight:void 0,adjustHegiht:0,showWall:!0,showClip:!1,showTerrian:!1},e.getTiles=function(){for(var t=[],i=e.viewer.scene.primitives.length,n=0;n<i;++n){var r=e.viewer.scene.primitives.get(n);r instanceof Cesium.Cesium3DTileset&&t.push(r)}return t},e.getInverseTransform=function(e){var t,i=e.root.computedTransform;return t=i&&i.equals(Cesium.Matrix4.IDENTITY)||!i?Cesium.Transforms.eastNorthUpToFixedFrame(e.boundingSphere.center):e.root.computedTransform,Cesium.Matrix4.inverseTransformation(t,new Cesium.Matrix4)},e.getOriginCoordinateSystemPoint=function(e,t){return Cesium.Matrix4.multiplyByPoint(t,e,new Cesium.Cartesian3(0,0,0))},e.createPlane=function(t,i,n){var r=t.clone(),s=i.clone();if(n){var a=e.getInverseTransform(n);r=e.getOriginCoordinateSystemPoint(r,a),s=e.getOriginCoordinateSystemPoint(s,a)}var o=new Cesium.Cartesian3(0,0,1),l=Cesium.Cartographic.fromCartesian(s);l.height=l.height+10;var u=Cesium.Cartographic.toCartesian(l);o=Cesium.Cartesian3.normalize(Cesium.Cartesian3.subtract(s,u,new Cesium.Cartesian3),new Cesium.Cartesian3).clone();var c=Cesium.Cartesian3.subtract(r,s,new Cesium.Cartesian3),h=(Cesium.Cartesian3.subtract(s,r,new Cesium.Cartesian3),Cesium.Cartesian3.ZERO);h=Cesium.Cartesian3.cross(c,o,new Cesium.Cartesian3),h=Cesium.Cartesian3.normalize(h,h);var m=Cesium.Plane.fromPointNormal(r,h);return Cesium.ClippingPlane.fromPlane(m)},e}return Object(r.a)(i,[{key:"createEventHandler",value:function(){var e=this,t=new Cesium.ScreenSpaceEventHandler(this.viewer.canvas);this.handler=t,null!=this.currentMeasure&&this.currentMeasure.state!=y.b.FINISHED||(this.currentMeasure=new k(this.viewer)),t.setInputAction((function(t){if(e.beActived){if(e.currentMeasure.state==y.b.COMPUING)return;e.sample(t.position)}}),Cesium.ScreenSpaceEventType.LEFT_CLICK),t.setInputAction((function(i){if(e.beActived){if(e.currentMeasure.state==y.b.COMPUING)return;e.beActived&&e.currentMeasure.samplePoints.length>2&&e.endSample(),t.destroy(),t=null}}),Cesium.ScreenSpaceEventType.RIGHT_CLICK)}},{key:"sample",value:function(e){var t=this.addSamplePoint(e);t&&(this.currentMeasure.samplePoints.push(t),this.onSampleChange.raiseEvent(Object(g.a)(Object(g.a)({},this.currentMeasure),{},{options:Object(g.a)({},this.measureOptions)})))}},{key:"endSample",value:function(){var e=Object(C.a)(v.a.mark((function e(){var t,i,n,r,s,a,o,l,u,c,h,m,p,d,C,g,f,w,b,P,E,S,I=this;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return this.currentMeasure.state=y.b.COMPUING,this.onSampleChange.raiseEvent(this.currentMeasure),t=this.currentMeasure.samplePoints,e.next=5,this.sampleVolume(this.viewer,t.map((function(e){return e.pos})));case 5:if(i=e.sent,this.beActived){e.next=9;break}return i.volumeSamplePoints.forEach((function(e){I.viewer.entities.remove(e)})),e.abrupt("return");case 9:for(i.sample_projectPosArr=i.sample_projectPosArr.map((function(e){var t=Cesium.Cartographic.fromCartesian(e);return Cesium.Cartesian3.fromRadians(t.longitude,t.latitude,i.minHeight)})),this.currentMeasure.centerPos=i.sample_centerPos,this.currentMeasure.projectPosArr=i.sample_projectPosArr,this.currentMeasure.basePloygonArea=i.basePloygonArea,this.currentMeasure.volumeSamplePoints=i.volumeSamplePoints,this.currentMeasure.sampleHeightToPlan=i.sampleHeightToPlan,this.currentMeasure.minHeight=i.minHeight,this.currentMeasure.maxHeight=i.maxHeight,this.currentMeasure.options={basePlanHeight:i.minHeight,adjustheight:0},this.maxHeight=i.maxHeight+2,this.minHeight=i.minHeight,n=this.drawVolumeWall(this.viewer,{points:i.sample_projectPosArr,minHeight:i.minHeight,maxHeight:i.maxHeight}),this.currentMeasure.Wall=n.wall,this.currentMeasure.Wall.show=this.measureOptions.showWall,this.currentMeasure.basePlan=n.plan,this.currentMeasure.endSample(),r=this.currentMeasure.basePlan.polygon.hierarchy.getValue(Cesium.JulianDate.now()).positions,s=Cesium.BoundingSphere.fromPoints(r),a=s.center,(o=Cesium.Cartographic.fromCartesian(a)).height=this.minHeight,a=Cesium.Cartographic.toCartesian(o),l=[],u=0,r.forEach((function(e){var t=Cesium.Cartographic.fromCartesian(e);u=t.height,l.push(x.point([Cesium.Math.toDegrees(t.longitude),Cesium.Math.toDegrees(t.latitude)]))})),c=x.featureCollection(l),h=x.center(c),m=Cesium.Cartesian3.fromDegrees(h.geometry.coordinates[0],h.geometry.coordinates[1],u),this.currentMeasure.basePlan.position=m,this.currentMeasure.basePlan.orientation=Cesium.Transforms.headingPitchRollQuaternion(m,new Cesium.HeadingPitchRoll(0,0,0)),this.control||(this.control=new O(this.viewer),this.control.add(this.currentMeasure.basePlan,m,s,i.maxHeight-i.minHeight)),p=[],d=Number.NEGATIVE_INFINITY,C=Cesium.Cartographic.ZERO,t.forEach((function(e){var t=Cesium.Cartographic.fromCartesian(e.pos);t.height>d&&(C=t.clone(),d=t.height)})),(g=C.clone()).height=i.minHeight,(f=C.clone()).height=i.maxHeight+2,this.highestPoint=Cesium.Cartographic.toCartesian(f),this.lowestPoint=Cesium.Cartographic.toCartesian(g),p.push(this.highestPoint),p.push(this.lowestPoint),this.keduLine||(this.keduLine=this.viewer.entities.add({polyline:{positions:p,width:3}})),w=f.height-g.height,b=g.clone(),P=0,2,this.keduLabel||(this.keduLabel=[]),this.keduPoint||(this.keduPoint=[]);P<w;)E=this.viewer.entities.add({position:Cesium.Cartographic.toCartesian(b),point:{show:!1,pixelSize:5,color:Cesium.Color.RED,outlineColor:Cesium.Color.DEEPPINK,outlineWidth:2,disableDepthTestDistance:Number.POSITIVE_INFINITY}}),S=this.viewer.entities.add({position:Cesium.Cartographic.toCartesian(b),label:{show:new Cesium.ConstantProperty(!1),text:"--"+P.toFixed(1),horizontalOrigin:new Cesium.ConstantProperty(Cesium.HorizontalOrigin.LEFT),disableDepthTestDistance:new Cesium.ConstantProperty(Number.POSITIVE_INFINITY),font:"14px"}}),this.keduLabel.push(S),this.keduPoint.push(E),P+=2,b.height+=2;this.isShowKedu(),this.wheelHandler||(this.wheelHandler=new Cesium.ScreenSpaceEventHandler(this.viewer.scene.canvas),this.wheelHandler.setInputAction((function(e){I.isShowKedu()}),Cesium.ScreenSpaceEventType.WHEEL),this.wheelHandler.setInputAction((function(e){I.isShowKedu()}),Cesium.ScreenSpaceEventType.MOUSE_MOVE)),this.onEndMeasure.raiseEvent(this.currentMeasure);case 63:case"end":return e.stop()}}),e,this)})));return function(){return e.apply(this,arguments)}}()},{key:"isShowKedu",value:function(){Cesium.Cartesian3.distance(this.viewer.camera.position,this.lowestPoint)<400?(this.keduLabel.forEach((function(e){return e.label.show=new Cesium.ConstantProperty(!0)})),this.keduPoint.forEach((function(e){return e.point.show=new Cesium.ConstantProperty(!0)}))):(this.keduLabel.forEach((function(e){return e.label.show=new Cesium.ConstantProperty(!1)})),this.keduPoint.forEach((function(e){return e.point.show=new Cesium.ConstantProperty(!1)})))}},{key:"refresh",value:function(e){this.measureOptions.adjustHegiht=e}},{key:"showWall",value:function(e){this.measureOptions.showWall=e,this.currentMeasure.Wall&&(this.currentMeasure.Wall.show=e)}},{key:"showClip",value:function(e){this.measureOptions.showClip=e,this.clippingPlanes&&(this.clippingPlanes.enabled=e);var t=this.getTiles();t&&t.length>0&&t.forEach((function(t){return t.clippingPlanes.enabled=e}))}},{key:"showTerrian",value:function(e){this.measureOptions.showTerrian=e,this.viewer.scene.globe.show=this.measureOptions.showTerrian}},{key:"disActive",value:function(){var e=this;w(Object(f.a)(i.prototype),"disActive",this).call(this),this.control&&this.control.destroy(),this.keduLine&&this.viewer.entities.remove(this.keduLine),this.keduLabel&&this.keduLabel.forEach((function(t){return e.viewer.entities.remove(t)})),this.keduPoint&&this.keduPoint.forEach((function(t){return e.viewer.entities.remove(t)})),this.wheelHandler&&(this.wheelHandler.destroy(),this.wheelHandler=null);var t=this.getTiles();t&&t.length>0&&t.forEach((function(e){e.clippingPlanes&&e.clippingPlanes.removeAll()})),this.viewer.scene.globe.show=!0}},{key:"sampleVolume",value:function(){var e=Object(C.a)(v.a.mark((function e(t,i){var n,r,s,a,o,l,u,c,h,m,p,d,C,g,f,w,y,b,x,E,S,I,M,T,O,k,j,A,H,N,L,R,F,W=this,V=arguments;return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:n=V.length>2&&void 0!==V[2]?V[2]:5,r=V.length>3&&void 0!==V[3]?V[3]:50,s=Number.POSITIVE_INFINITY,i.forEach((function(e){var t=Cesium.Cartographic.fromCartesian(e);t.height<s&&(s=t.height)})),a=s,o=Cesium.BoundingSphere.fromPoints(i).center,l=Cesium.Cartographic.fromCartesian(o),u=Cesium.Cartesian3.fromRadians(l.longitude,l.latitude,a),c=Cesium.Ellipsoid.WGS84.geodeticSurfaceNormal(u),h=Cesium.Plane.fromPointNormal(u,c),m=i.map((function(e){return Cesium.Plane.projectPointOntoPlane(h,e)})),p=Cesium.Cartesian3.subtract(m[1],m[0],new Cesium.Cartesian3),Cesium.Cartesian3.normalize(p,p),d=h.normal,C=Cesium.Cartesian3.cross(d,p,new Cesium.Cartesian3),g=new Cesium.Matrix4(p.x,C.x,d.x,u.x,p.y,C.y,d.y,u.y,p.z,C.z,d.z,u.z,0,0,0,1),f=Cesium.Matrix4.inverse(g,new Cesium.Matrix4),w=[],y=new Cesium.Cartesian2(Number.NEGATIVE_INFINITY,Number.NEGATIVE_INFINITY),b=new Cesium.Cartesian2(Number.POSITIVE_INFINITY,Number.POSITIVE_INFINITY),m.forEach((function(e){var t=Cesium.Matrix4.multiplyByPoint(f,e,new Cesium.Cartesian3);return t.z=0,w.push(t),t.x<b.x&&(b.x=t.x),t.y<b.y&&(b.y=t.y),t.x>y.x&&(y.x=t.x),t.y>y.y&&(y.y=t.y),t})),x=P.compute(w),E=y.x-b.x,S=y.y-b.y,I=Math.ceil(E/n),M=Math.ceil(S/n),Math.max(I,M)<r&&(T=E/r,O=S/r,n=Math.max(T,O)),I=Math.ceil(E/n),M=Math.ceil(S/n),k=[],j=[],A=20,H=Number.NEGATIVE_INFINITY,N=this.filterSamplePoint(I,M,b,n,w),L=N.map((function(e){return Cesium.Matrix4.multiplyByPoint(g,e,new Cesium.Cartesian3)})),R=v.a.mark((function e(i){return v.a.wrap((function(e){for(;;)switch(e.prev=e.next){case 0:return e.next=2,new Promise((function(e,n){setTimeout((function(){for(var n=0;n<A&&W.beActived;n++){var r=i*A+n;if(!(r<L.length))break;var a=t.scene.clampToHeight(L[r],t.entities.values);if(null!=a){var o=Cesium.Cartographic.fromCartesian(a).height;o>H&&(H=o),o<s&&(s=o);var l=Cesium.Plane.getPointDistance(h,a);k.push(l);var u=_(t,a.clone());j.push(u)}}e()}))}));case 2:case"end":return e.stop()}}),e)})),F=0;case 38:if(!(F<Math.ceil(L.length/A)&&this.beActived)){e.next=43;break}return e.delegateYield(R(F),"t0",40);case 40:F++,e.next=38;break;case 43:return e.abrupt("return",{sample_interval:n,sample_points:i,sample_centerPos:o,sample_projectPosArr:m,basePloygonArea:x,volumeSamplePoints:j,sampleHeightToPlan:k,minHeight:s,maxHeight:H});case 44:case"end":return e.stop()}}),e,this)})));return function(t,i){return e.apply(this,arguments)}}()},{key:"filterSamplePoint",value:function(e,t,i,n,r){for(var s=[],a=0;a<=e;a++)for(var o=0;o<=t;o++){var l=new Cesium.Cartesian3(i.x+(a+.5)*n,i.y+(o+.5)*n,0);A(l,r)&&s.push(l)}return s}},{key:"drawVolumeWall",value:function(e,t){var i=this,n=t.points,r=t.maxHeight,s=t.minHeight,a=n.concat(n[0]),o=e.entities.add({polygon:{hierarchy:n,perPositionHeight:!0,material:new Cesium.Color(1,203/255,0).withAlpha(.36),outline:!0,outlineColor:Cesium.Color.BLACK,outlineWidth:5}}),l=e.entities.add({wall:{positions:a,minimumHeights:a.map((function(e){return s})),maximumHeights:a.map((function(e){return r+2})),material:new Cesium.Color(61/255,180/255,239/255).withAlpha(.36),outline:!0,outlineColor:new Cesium.Color(0,79/255,128/255)}});this.viewer.scene.globe.show=this.measureOptions.showTerrian;var u=this.getTiles();return u&&u.length>0&&u.forEach((function(e){var t=i.getClippingPlanes(n,e);t.enabled=i.measureOptions.showClip,e.clippingPlanes=t})),this.clippingPlanes||(this.clippingPlanes=this.getClippingPlanes(n),this.clippingPlanes.enabled=this.measureOptions.showClip),this.viewer.scene.globe.clippingPlanes=this.clippingPlanes,{plan:o,wall:l}}},{key:"getClippingPlanes",value:function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:null,i=Number.NEGATIVE_INFINITY,n=Number.POSITIVE_INFINITY,r=Cesium.Cartographic.ZERO;Cesium.Cartographic.ZERO;e.forEach((function(e){var t=Cesium.Cartographic.fromCartesian(e);t.height<n&&(t.clone(),n=t.height),t.height>i&&(r=t.clone(),i=t.height)})),r.height=i+10;var s=e.map((function(e){return Cesium.Cartographic.fromCartesian(e)})),a=[],o=Object(p.a)(e);s.forEach((function(e){return a.push([Cesium.Math.toDegrees(e.longitude),Cesium.Math.toDegrees(e.latitude)])})),a.push(a[0]),x.booleanClockwise(x.lineString(a))||(o=e.reverse());for(var l=[],u=0;u<o.length-1;u++)l.push(this.createPlane(o[u],o[u+1],t));return l.push(this.createPlane(o[o.length-1],o[0],t)),new Cesium.ClippingPlaneCollection({planes:l,unionClippingRegions:!0,edgeColor:Cesium.Color.TRANSPARENT,edgeWidth:1})}}]),i}(y.a);function _(e,t){return e.entities.add({position:t,point:{color:new Cesium.Color(126/255,68/255,1).withAlpha(.86),pixelSize:2}})}function A(e,t){for(var i=0,n=0;n<t.length;n++){var r=t[n],s=t[(n+1)%t.length];if(r.y!=s.y)if(!(e.y<Math.min(r.y,s.y)))if(!(e.y>=Math.max(r.y,s.y)))(e.y-r.y)*(s.x-r.x)/(s.y-r.y)+r.x>e.x&&i++}return i%2==1}var H=i(486),N=i(488),L=(i(490),i(23)),R=function(e){Object(h.a)(i,e);var t=Object(m.a)(i);function i(e){var r;return Object(n.a)(this,i),(r=t.call(this,e)).state={basePlaneHeight:0,disable:!1,beActived:!0,tagText:null,sliderValue:0,sliderDetailValue:0,_labelPoint:null,_label:null,showTag:!0,highestPoint:null,lowestPoint:null},r.ins=void 0,r.currentResult=void 0,r.stateChange=void 0,r.recomputeVlume=function(e){if(r.currentResult){r.currentResult.options.adjustheight=e,r.currentResult.endSample();var t=r.currentResult,i=(t.tag,t.result),n=t.options,s="\u6316\u65b9\u4f53\u79ef\uff1a".concat(i.cutVolume.toFixed(2)," m\xb3\n\u586b\u65b9\u4f53\u79ef\uff1a").concat(i.fillVolume.toFixed(2)," m\xb3\n\u57fa\u51c6\u9762\u6d77\u62d4\u9ad8\u5ea6\uff1a").concat((n.adjustheight+n.basePlanHeight).toFixed(2)," m");r.setState({_label:s})}},r.stateChange=new Cesium.Event,r}return Object(r.a)(i,[{key:"componentDidMount",value:function(){var e=this;this.ins=new j(this.props.viewer),this.ins.onStateChange.addEventListener((function(t){e.setState({disable:!0}),t&&e.setState({tagText:"\u5de6\u5355\u51fb-\u5f00\u59cb\u7ed8\u5236"})})),this.ins.onSampleChange.addEventListener((function(t){var i=t.samplePoints.length;t.state==y.b.COMPUING?e.setState({tagText:"\u8ba1\u7b97\u4e2d...."}):(0==i&&e.setState({tagText:"\u5de6\u5355\u51fb-\u5f00\u59cb\u7ed8\u5236"}),i>0&&i<=2&&e.setState({tagText:"\u5de6\u5355\u51fb-\u589e\u52a0\u70b9"}),i>2&&e.setState({tagText:"\u5de6\u5355\u51fb-\u589e\u52a0\u70b9 \u53f3\u5355\u51fb\u7ed3\u675f\u7ed8\u5236"}))})),this.ins.onEndMeasure.addEventListener((function(t){e.props.onMeasureEnd&&e.props.onMeasureEnd(t),e.ins.highestPoint&&e.ins.lowestPoint&&e.setState({highestPoint:e.ins.highestPoint,lowestPoint:e.ins.lowestPoint}),e.setState({disable:!1}),e.setState({basePlaneHeight:Cesium.Cartographic.fromCartesian(t.centerPos).height}),e.setState({showTag:!1}),e.stateChange.raiseEvent(!1);var i="\u6316\u65b9\u4f53\u79ef\uff1a".concat(t.result.cutVolume.toFixed(2)," m\xb3\n\u586b\u65b9\u4f53\u79ef\uff1a").concat(t.result.fillVolume.toFixed(2)," m\xb3\n\u57fa\u51c6\u9762\u6d77\u62d4\u9ad8\u5ea6\uff1a").concat((t.options.adjustheight+t.options.basePlanHeight).toFixed(2)," m");e.setState({_label:i,_labelPoint:t.centerPos}),e.currentResult=t})),this.ins.active()}},{key:"componentWillUnmount",value:function(){var e;null===(e=this.ins)||void 0===e||e.disActive(),this.props.viewer.scene.globe.clippingPlanes&&(this.props.viewer.scene.globe.clippingPlanes.destroy(),this.props.viewer.scene.globe.clippingPlanes=null)}},{key:"render",value:function(){return Object(L.jsxs)(a.a.Fragment,{children:[this.state.showTag?Object(L.jsx)(H.a,{viewer:this.props.viewer,trackCursor:!0,alignX:"left",alignY:"center",children:Object(L.jsx)(N.a,{text:this.state.tagText})}):null,this.state._labelPoint?Object(L.jsx)(H.a,{viewer:this.props.viewer,trackPos:this.state._labelPoint,alignX:"left",alignY:"center",children:Object(L.jsx)(N.a,{text:this.state._label})}):Object(L.jsx)(L.Fragment,{}),this.state.lowestPoint?Object(L.jsx)(H.a,{viewer:this.props.viewer,trackPos:this.state.lowestPoint,alignX:"left",alignY:"center",children:Object(L.jsx)(N.a,{text:this.ins.minHeight.toFixed(2)+"\u7c73"})}):Object(L.jsx)(L.Fragment,{}),this.state.highestPoint?Object(L.jsx)(H.a,{viewer:this.props.viewer,trackPos:this.state.highestPoint,alignX:"left",alignY:"center",children:Object(L.jsx)(N.a,{text:this.ins.maxHeight.toFixed(2)+"\u7c73"})}):Object(L.jsx)(L.Fragment,{})]})}}]),i}(a.a.Component),F=function(){function e(t,i,r){Object(n.a)(this,e),this.viewer=t,this.cesium=i,this.extensionName="Measurement/measureTools/volume",this.id=this.getGuid(),this.com=null,this.isRunning=!0}return Object(r.a)(e,[{key:"getGuid",value:function(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:"xxxxxxxxxx",t=(new Date).getTime(),i=e.replace(/[xy]/g,(function(e){var i=(t+16*Math.random())%16|0;return t=Math.floor(t/16),("x"==e?i:7&i|8).toString(16)}));return i}},{key:"reCompute",value:function(e){this.com.recomputeVlume(e)}},{key:"showWall",value:function(e){this.com.ins.showWall(e)}},{key:"showClip",value:function(e){this.com.ins.showClip(e)}},{key:"showTerrian",value:function(e){this.com.ins.showTerrian(e)}},{key:"load",value:function(){var e=this,t=c()("#cesiumContainer")[0],i="<div id=".concat(this.id,"></div>");return c()(t).append(i),this.com=l.a.render(Object(L.jsx)(R,{viewer:this.viewer}),document.getElementById(this.id)),this.com.stateChange.addEventListener((function(t){return e.isRunning=t})),!0}},{key:"unload",value:function(){return l.a.unmountComponentAtNode(document.getElementById(this.id)),c()("#"+this.id).remove(),this.viewer.modes[this.extensionName]=null,!0}}]),e}()},456:function(e,t,i){"use strict";i.d(t,"c",(function(){return n})),i.d(t,"b",(function(){return r})),i.d(t,"d",(function(){return o})),i.d(t,"a",(function(){return l}));var n,r,s=i(49),a=i(50);function o(e,t){return e.entities.add({position:t,point:{pixelSize:5,color:Cesium.Color.WHITE,outlineColor:Cesium.Color.DEEPPINK,outlineWidth:2,disableDepthTestDistance:Number.POSITIVE_INFINITY}})}!function(e){e.POINT="\u70b9\u6d4b\u91cf",e.LINE="\u7ebf\u6bb5\u6d4b\u91cf",e.VOLUME="\u4f53\u79ef\u6d4b\u91cf",e.AREA="\u9762\u79ef\u6d4b\u91cf"}(n||(n={})),function(e){e.WAITING="\u7b49\u5f85\u4e2d",e.SAMPLING="\u91c7\u6837\u4e2d",e.COMPUING="\u8ba1\u7b97\u4e2d",e.FINISHED="\u6d4b\u91cf\u7ed3\u675f"}(r||(r={}));var l=function(){function e(t){var i=this;Object(s.a)(this,e),this.type=void 0,this.currentMeasure=void 0,this.handler=void 0,this._beActived=!1,this.viewer=void 0,this.addSamplePoint=function(e){var t=function(e,t){var i=e.camera.getPickRay(t),n=e.scene.pickFromRay(i,[]);return n&&null!=n.position?e.scene.clampToHeight(n.position):null}(i.viewer,e);return null!=t?{ins:o(i.viewer,t),pos:t}:null},this.active=function(){i.beActived=!0,i.onStateChange.raiseEvent(i.beActived)},this.onSampleChange=new Cesium.Event,this.onStateChange=new Cesium.Event,this.onEndMeasure=new Cesium.Event,this.viewer=t,this.createEventHandler()}return Object(a.a)(e,[{key:"beActived",get:function(){return this._beActived},set:function(e){this._beActived=e,this.onStateChange.raiseEvent(e)}},{key:"disActive",value:function(){this.beActived=!1,this.onStateChange.raiseEvent(this.beActived),this.currentMeasure.dispose(this.viewer),this.currentMeasure=void 0}}]),e}()},486:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var n=i(514),r=i(49),s=i(50),a=i(52),o=i(51),l=i(10),u=i.n(l),c=(i(487),i(23)),h=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(e){var n;(Object(r.a)(this,i),(n=t.call(this,e)).element=void 0,n.mousePos=void 0,n.onUpdate=function(){if(null!=n.element){var e;if(n.props.trackCursor)e=n.mousePos;else if(n.props.trackEntity){var t=n.props.trackEntity.position.getValue(Cesium.JulianDate.now());e=Cesium.SceneTransforms.wgs84ToWindowCoordinates(n.props.viewer.scene,t)}else n.props.trackPos&&(e=Cesium.SceneTransforms.wgs84ToWindowCoordinates(n.props.viewer.scene,n.props.trackPos));if(e){switch(n.element.style.display="",n.props.alignX){case"left":n.element.style.left=e.x+"px";break;case"center":n.element.style.left=e.x+.5*n.element.clientWidth+"px";break;case"right":default:n.element.style.left=e.x-.5*n.element.clientWidth+"px"}switch(n.props.alignY){case"top":n.element.style.top=e.y-n.element.clientHeight+"px";break;case"bottom":n.element.style.top=e.y+"px";break;case"center":default:n.element.style.top=e.y-.5*n.element.clientHeight+"px"}}else n.element.style.display="none"}},e.trackCursor)&&(new Cesium.ScreenSpaceEventHandler).setInputAction((function(e){var t=n.props.viewer.container.getBoundingClientRect();n.mousePos=Cesium.Cartesian2.subtract(e.endPosition,new Cesium.Cartesian2(t.left,t.top),new Cesium.Cartesian2)}),Cesium.ScreenSpaceEventType.MOUSE_MOVE);return n}return Object(s.a)(i,[{key:"componentDidMount",value:function(){this.props.viewer.scene.preUpdate.addEventListener(this.onUpdate)}},{key:"componentWillUnmount",value:function(){this.props.viewer&&!this.props.viewer.isDestroyed()&&this.props.viewer.scene.preUpdate.removeEventListener(this.onUpdate)}},{key:"render",value:function(){var e=this;return Object(c.jsxs)("div",{className:"cesium-tag",ref:function(t){return e.element=t},style:Object(n.a)({},this.props.textCss),children:[this.props.text,this.props.children]})}}]),i}(u.a.Component)},487:function(e,t,i){},488:function(e,t,i){"use strict";i.d(t,"a",(function(){return h}));var n,r=i(49),s=i(50),a=i(52),o=i(51),l=i(10),u=i.n(l),c=(i(489),i(23));!function(e){e.LEFT="left",e.BOTTOM="bottom"}(n||(n={}));var h=function(e){Object(a.a)(i,e);var t=Object(o.a)(i);function i(){return Object(r.a)(this,i),t.apply(this,arguments)}return Object(s.a)(i,[{key:"render",value:function(){var e;return Object(c.jsx)("div",{className:"chat-frame ".concat(null!==(e=this.props.location)&&void 0!==e?e:"left"),children:Object(c.jsx)("span",{children:this.props.text})})}}]),i}(u.a.Component)},489:function(e,t,i){},490:function(e,t,i){}}]);